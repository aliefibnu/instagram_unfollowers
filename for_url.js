(()=>{const a="iwr",b=1e3,c=1e4,d=4e3;let r=[],hnp=!0,tc=-1,p=0,fc=0,s="init",wr=JSON.parse(localStorage.getItem("iwr")||"[]"),ul=[],scc=0,fs="all";function gc(n){let t=`; ${document.cookie}`,o=t.split(`; ${n}=`);return 2===o.length?o.pop().split(";").shift():null}function ug(e){let t=gc("ds_user_id");if(!t)throw Error("No user ID");return`https://www.instagram.com/graphql/query/?query_hash=3dec7e2c57367ef3da3d987d89f9dbc8&variables={"id":"${t}","include_reel":"true","fetch_mutual":"false","first":"24"${e?`,"after":"${e}"`:""}}`}async function sl(e){return new Promise(t=>setTimeout(t,e))}async function fd(e=null){try{if(scc>=5){console.log("Pause...");await sl(c);scc=0}s="fetch";let t=ug(e),o=await fetch(t);if(!o.ok)throw Error(`HTTP ${o.status}`);let j=await o.json(),n=j?.data?.user?.edge_follow;if(!n)throw Error("Bad API response");tc===-1&&(tc=n.count);let i=n.edges.map(e=>({id:e.node.id,u:e.node.username,fn:e.node.full_name,pp:e.node.profile_pic_url,v:e.node.is_verified,pr:e.node.is_private,fv:e.node.follows_viewer}));r.push(...i);fc=r.length;p=Math.floor(fc/tc*100);hnp=n.page_info.has_next_page;let ec=n.page_info.end_cursor;scc++;await sl(b);rb();return{res:i,hnp,ec}}catch(e){console.error("Fetch err:",e.message);s="err";hnp=!1;rb();throw e}}function guc(){let e=r;"fb"===fs?e=r.filter(e=>e.fv):"nfb"===fs&&(e=r.filter(e=>!e.fv));return e.map(e=>`<div class="uc"><img src="${e.pp}" alt="${e.u}"><div class="ui"><div class="un">${e.u}${e.v?'<span class="vd">âœ”</span>':""}</div><p class="fn">${e.fn||"No name"}</p><div class="st"><span class="st ${e.pr?"prv":"pub"}">${e.pr?"Private":"Public"}</span><span class="st ${e.fv?"fl":"nfl"}">${e.fv?"Follows":"Not Following"}</span></div><button class="ub" data-uid="${e.id}">Unfollow</button></div></div>`)}function rb(){let st="* {margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}body{min-height:100vh;background:linear-gradient(135deg,#f9e1e8,#e6e6fa,#e0f7fa);padding:20px;color:#333}.c{max-width:1200px;margin:0 auto}h1{font-size:2rem;text-align:center;margin-bottom:20px;color:#4a4a4a}.ms{display:flex;gap:10px;justify-content:center;margin-bottom:20px}.mb{padding:10px 20px;border:none;border-radius:5px;background:linear-gradient(to right,#ff99cc,#cc99ff);color:#fff;font-weight:700;cursor:pointer;transition:transform .2s,box-shadow .2s}.mb:hover{transform:scale(1.05);box-shadow:0 4px 10px rgba(0,0,0,.2)}.mb.ac{background:linear-gradient(to right,#cc66aa,#9966cc)}.ps{background:rgba(255,255,255,.8);border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.1);backdrop-filter:blur(5px)}.pi{display:flex;justify-content:space-between;margin-bottom:10px;font-size:1rem;font-weight:700;color:#555}.pb{width:100%;height:10px;background:#e0e0e0;border-radius:5px;overflow:hidden}.pbf{height:100%;background:linear-gradient(to right,#ff99cc,#cc99ff);transition:width .3s}.ug{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}.uc{background:rgba(255,255,255,.8);border-radius:10px;padding:15px;display:flex;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,.1);transition:transform .2s,box-shadow .2s;backdrop-filter:blur(5px)}.uc:hover{transform:translateY(-5px);box-shadow:0 6px 15px rgba(0,0,0,.15)}.uc img{width:60px;height:60px;border-radius:50%;object-fit:cover;border:2px solid #ffd1dc;margin-right:15px}.ui{flex:1}.un{font-size:1.2rem;font-weight:700;color:#4a4a4a;display:flex;align-items:center}.vd{color:#3399ff;margin-left:5px;font-size:.9rem}.fn{font-size:.9rem;color:#666;margin:5px 0}.st{display:flex;gap:8px;margin-top:5px}.st{font-size:.75rem;padding:4px 8px;border-radius:12px}.prv{background:#e6ccff;color:#663399}.pub{background:#ccffcc;color:#339933}.fl{background:#b3d9ff;color:#0066cc}.nfl{background:#e6e6e6;color:#666}.sm{text-align:center;margin-top:20px;font-size:1.1rem;font-weight:500;color:#555}@media (max-width:768px){h1{font-size:1.5rem}.pi{flex-direction:column;gap:10px;font-size:.9rem}.ms{flex-direction:column;align-items:center}.mb{width:100%;max-width:200px}.ug{grid-template-columns:1fr}.uc{padding:10px}.uc img{width:50px;height:50px}.un{font-size:1rem}.fn{font-size:.8rem}}@media (max-width:480px){body{padding:10px}.c{padding:0}.ps{padding:15px}.sm{font-size:1rem}}.ub{margin-top:10px;padding:8px 16px;border:none;border-radius:5px;background:linear-gradient(to right,#ff6666,#cc3333);color:#fff;font-weight:700;cursor:pointer;transition:transform .2s,box-shadow .2s}.ub:hover{transform:scale(1.05);box-shadow:0 4px 10px rgba(0,0,0,.2)}.ub:disabled{background:#ccc;cursor:not-allowed}",msg=s==="fetch"?"Fetching...":s==="comp"?"Done!":s==="err"?"Error":"Ready";document.body.innerHTML=`<style>${st}</style><div class="c"><h1>Your Instagram Following</h1><div class="ms"><button class="mb ab ${fs==="all"?"ac":""}" data-f="all">All</button><button class="mb fbb ${fs==="fb"?"ac":""}" data-f="fb">Follows Back</button><button class="mb nfbb ${fs==="nfb"?"ac":""}" data-f="nfb">Not Following</button></div><div class="ps"><div class="pi"><span>Progress: <span id="p">${p}%</span></span><span>Fetched: <span id="t">${fc} / ${tc}</span></span></div><div class="pb"><div id="pb" class="pbf" style="width:${p}%"></div></div></div><div class="ug">${guc().join("")}</div><div class="sm"><p id="s">${msg}</p></div></div>`;document.querySelectorAll(".mb").forEach(e=>e.addEventListener("click",()=>{fs=e.getAttribute("data-f");rb()}));document.querySelectorAll(".ub").forEach(e=>e.addEventListener("click",async()=>{let id=e.getAttribute("data-uid"),u=e.closest(".uc").querySelector(".un").textContent.trim();if(window.confirm(`Unfollow ${u}?`)){e.disabled=!0;try{await uf(id);e.textContent="Unfollowed"}catch(err){console.error("Unfollow err:",err.message);e.textContent="Error"}}}))}async function uf(id){try{let t=await fetch(`/web/friendships/${id}/unfollow/`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRFToken":gc("csrftoken"),"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw Error(`HTTP ${t.status}`);let j=await t.json();if(j.status!=="ok")throw Error("Unfollow failed");r=r.filter(t=>t.id!==id);fc=r.length;p=Math.floor(fc/tc*100);ul.push(id);await sl(d);rb()}catch(e){throw Error(`Unfollow err: ${e.message}`)}}async function main(){if(s!=="init"){console.error("Scan busy");return}try{rb();let ec=null;while(hnp){let{res,hnp:np,ec:nc}=await fd(ec);ec=nc}s="comp"}catch(e){console.error("Main err:",e.message);s="err"}finally{rb()}}window.rb=rb;main();})()